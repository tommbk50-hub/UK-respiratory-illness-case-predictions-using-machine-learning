<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Influenza Prediction Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .dashboard-container { max-width: 1200px; margin: 30px auto; padding: 20px; }
        .card { box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: none; margin-bottom: 20px; }
        .header-title { color: #2c3e50; font-weight: 700; }
        .loading-text { text-align: center; color: #666; margin-top: 50px; }
        .metric-box { text-align: center; padding: 20px; background: white; border-radius: 8px; }
        .metric-value { font-size: 2em; font-weight: bold; color: #007bff; }
        .metric-label { color: #6c757d; text-transform: uppercase; font-size: 0.8em; letter-spacing: 1px; }
    </style>
</head>
<body>

    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">Influenza Forecasting Model</span>
            <a href="https://github.com/tommbk50-hub/Data-Science-and-Anakytics-Projects" class="btn btn-outline-light btn-sm">View on GitHub</a>
        </div>
    </nav>

    <div class="dashboard-container">
        <div class="row mb-4">
            <div class="col-md-8">
                <h2 class="header-title">Hybrid Seasonal + Residual Forecast</h2>
                <p class="text-muted">Predicting influenza positivity rates in England using HistGradientBoostingRegressor.</p>
            </div>
            <div class="col-md-4 text-end">
                <p class="text-muted small">Last Updated: <span id="last-updated">Loading...</span></p>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card metric-box">
                    <div class="metric-value" id="latest-actual">--%</div>
                    <div class="metric-label">Latest Actual Positivity</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card metric-box">
                    <div class="metric-value" id="peak-forecast">--%</div>
                    <div class="metric-label">Predicted Peak (Next 52 Wks)</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card metric-box">
                    <div class="metric-value" id="next-week">--%</div>
                    <div class="metric-label">Forecast Next Week</div>
                </div>
            </div>
        </div>

        <div class="card p-3">
            <div id="plot-div" style="width:100%; height:600px;"></div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card p-4">
                    <h5>Methodology</h5>
                    <p class="small text-muted mb-0">
                        This model uses a hybrid approach. First, a seasonal baseline is established using historical Week/Month trends. 
                        Second, a recursive residual model predicts the deviation from that baseline based on recent errors (lags). 
                        The final forecast is the sum of the seasonal baseline and the predicted residual.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fetch the JSON data generated by the Python script
        fetch('dashboard_data.json')
            .then(response => response.json())
            .then(data => {
                const history = data.history;
                const forecast = data.forecast;

                // 1. Setup Traces for Plotly
                const traceHistory = {
                    x: history.dates,
                    y: history.values,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Historical Data',
                    line: { color: 'rgba(0,0,0,0.4)', width: 2 }
                };

                const traceBaseline = {
                    x: forecast.dates,
                    y: forecast.baseline,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Seasonal Baseline',
                    line: { color: 'green', dash: 'dot', width: 2 }
                };

                const traceForecast = {
                    x: forecast.dates,
                    y: forecast.values,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Hybrid Forecast',
                    line: { color: '#007bff', width: 3 }
                };

                // 2. Layout Configuration
                const layout = {
                    title: 'Influenza Positivity Rate: History vs Forecast',
                    xaxis: { title: 'Date', showgrid: true },
                    yaxis: { title: 'Positivity Rate (%)', showgrid: true },
                    hovermode: 'x unified',
                    showlegend: true,
                    legend: { orientation: 'h', y: 1.1 }
                };

                // 3. Render Plot
                Plotly.newPlot('plot-div', [traceHistory, traceBaseline, traceForecast], layout);

                // 4. Update Summary Cards
                const latestVal = history.values[history.values.length - 1];
                const maxForecast = Math.max(...forecast.values);
                const nextVal = forecast.values[0];

                document.getElementById('latest-actual').innerText = latestVal.toFixed(2) + '%';
                document.getElementById('peak-forecast').innerText = maxForecast.toFixed(2) + '%';
                document.getElementById('next-week').innerText = nextVal.toFixed(2) + '%';
                
                // Set update date
                const today = new Date().toLocaleDateString();
                document.getElementById('last-updated').innerText = today;
            })
            .catch(error => {
                console.error('Error loading data:', error);
                document.getElementById('plot-div').innerHTML = '<p class="text-danger text-center">Error loading dashboard_data.json. Please ensure the Python script has been run and the file is in the repository.</p>';
            });
    </script>
</body>
</html>
